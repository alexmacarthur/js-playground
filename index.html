<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>

    <body>
        <span id="element">original text</span>

        <style>
            body {
                display: flex;
                justify-content: center;
                align-items: center;
            }
        </style>

        <script>
            window.addEventListener('load', () => {

                // const timesToRun = 1000;
                // let totalCount = 0;
                // let previousTime = 0;
                // let timeDifferences = [];

                // console.log(`Calculating refresh rate with ${timesToRun} runs...`);

                // const outputMetrics = () => {
                //     let total = timeDifferences.reduce((total, time) => {
                //         total = total + time;
                //         return total;
                //     }, 0);
                //     let average = total / timeDifferences.length;

                //     console.log(`Can repaint every: ${Math.round(average)} milliseconds`);
                //     console.log(`Refresh Rate: ${Math.round(1000 / average)} times per second`);
                // }

                // Run a callback before every time the browser is able to repaint, which _should_ be equal to the refresh rate of the screen.
                // const logReadyToPaint = (timestamp) => {
                //     if(previousTime) {
                //         let diff = timestamp - previousTime;
                //         timeDifferences.push(diff);
                //     }

                //     previousTime = timestamp;                
                //     totalCount++;

                //     if (totalCount <= timesToRun) {
                //         requestAnimationFrame(logReadyToPaint);
                //     } else {
                //         outputMetrics();
                //     }
                // }

                // requestAnimationFrame(logReadyToPaint);

                // let styleChangeTime;
                // let logTime;

                // const callback = function (mutationsList, observer) {
                //     for (let mutation of mutationsList) {
                //         if (mutation.type === 'attributes') {
                //             styleChangeTime = Date.now();
                //             console.log(`The ${mutation.attributeName} attribute was changed at ${styleChangeTime}.`);
                //         }
                //     }
                // };

                // (new MutationObserver(callback)).observe(document.body, { attributes: true });
                
                // setTimeout(() => {



                // console.log(element.innerHTML);
                function timeout() {
                    alert("stop!");
                }

                function updateElement() {
                    const element = document.getElementById('element');
                    element.innerHTML = "updated text";
                }

                updateElement();
                setTimeout(timeout, 0);

                requestAnimationFrame(() => {
                    // before next repaint
                    
                    // after next repaint
                    requestAnimationFrame(() => {
                        alert("stop!");
                    });
                });













                // console.log(element.innerHTML);

                // alert('STOP');
                    // alert();
                // }, 100);
                

                // logTime = Date.now();
                // console.log(`Logged at ${logTime}.`);
                // console.log(logTime - styleChangeTime);







            });



            

            // makeChangeToDom(); // change button text

            // doSomethingElse(); // 







            // element.innerHTML = "1";
            // element.innerHTML = "2";

            // how do i FORCE a repaint based on the JS run so far? 
        // chrome.runtime.onMessage.addListener(
        // function (request, sender, sendResponse) {
        //     console.log(sender.tab ?
        //         "from a content script:" + sender.tab.url :
        //         "from the extension");
        //     if (request.greeting == "hello")
        //         sendResponse({ farewell: "goodbye" });
        // });

        // Will fire whenever the browser is ready to repaint... 
        // If you want it to be called again, you need to do it again...
            // element.offsetHeight;

            // element.style.webkitTransform = 'scale(1)';

            // debugger;
            // alert("HEY");



            // console.log(element.scrollHeight);

            // requestAnimationFrame(() => {
            //     console.log('hiii');
                
            //     return requestAnimationFrame(() => {
            //         alert('hi');
            //     });
            // });

            // setTimeout(() => {
            // }, 1000);


            // setTimeout(() => {
            //     document.body.insertBefore(document.createTextNode("2"), element);

            //     setTimeout(() => {
            //         document.body.insertBefore(document.createTextNode("3"), element);
            //     }, 100);
            // }, 100);

        </script>
        <!-- <script src="./index.js"></script> -->
    </body>
</html>
